# Feature Specification: OCR結果表示画面：表示項目の左横に項目番号を表示

**Feature Branch**: `002-add-ocr-item-numbers`  
**Created**: 2025-11-04  
**Status**: Draft  
**Input**: User description: "OCR結果表示画面で表示項目の左横に項目番号を表示する機能を追加します。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 項目参照の迅速化 (Priority: P1)

ユーザーはOCR結果表示画面で複数の項目を確認・指摘する際、各項目の左横に表示された番号を用いて「項目12を確認してください」のように正確に参照できる。

**Why this priority**: レビュー効率とコミュニケーション精度の改善が主目的であり、最も直接的な価値を提供するため。

**Independent Test**: 通常のOCR結果画面を開き、可視項目に連番が表示されていること、番号が一意で重複がないことを確認するだけで価値を検証可能。

**Acceptance Scenarios**:

1. Given OCR結果表示画面を開いた, When 画面が描画される, Then 各可視項目の左横に1から始まる番号が表示される
2. Given 画面をスクロールした, When 新たな項目が表示域に入る, Then 左横の番号が途切れずに視認できる
3. Given 複数の項目が並ぶ, When 任意の2項目を比較する, Then 各項目の番号は重複せず一意である

---

### User Story 2 - フィルタ/並び替え後の参照 (Priority: P2)

ユーザーは項目のフィルタや並び替えを行った後でも、左横の番号で迷わず参照・指示ができる。

**Why this priority**: 実務では並び替えやフィルタを頻繁に行うため、参照手段が一貫していることが重要。

**Independent Test**: 並び替え/フィルタ適用後の画面で番号表示が崩れないこと、重なりや欠落がないことを個別に確認可能。

**Acceptance Scenarios**:

1. Given 項目を並び替えた, When 画面が更新される, Then 各可視項目に番号が正しく表示され重複がない
2. Given 項目をフィルタした, When 非表示項目がある, Then 表示中の可視項目のみが番号表示対象になる

---

### User Story 3 - アクセシビリティ対応 (Priority: P3)

スクリーンリーダー利用者は、項目番号→ラベル→値の順で読み上げられることで、非可視ユーザーでも番号を用いた参照が可能になる。

**Why this priority**: 参照手段をすべての利用者に提供し、アクセシビリティ要件に配慮するため。

**Independent Test**: スクリーンリーダーで任意の項目にフォーカスした際、番号が読み上げに含まれることを確認する。

**Acceptance Scenarios**:

1. Given スクリーンリーダーが有効, When 項目にフォーカスする, Then 番号→ラベル→値の順で読み上げられる
2. Given キーボード操作のみ, When 項目にフォーカス移動, Then 番号が視覚的にも分かる位置に常に表示されている

---

### Edge Cases

- 折りたたみセクション内の項目（開閉時の番号の扱い）
- 非表示/無効化された項目（番号付与対象外の扱い）
- 非同期読み込みで遅れて表示される項目（番号の欠番や重複がないこと）
- 小さい画面幅（320px相当）での折返しや重なり防止
- ラベルが非常に長い場合のレイアウト崩れ防止
- 複数タブ/セクション/ページに分かれる画面の採番範囲

## Requirements *(mandatory)*

### Functional Requirements

- FR-001: 各「可視の表示項目」の左横に、1から始まる半角アラビア数字の番号を表示する。
- FR-002: 番号は項目ラベル直前に配置し、ラベル/値と視覚的に関連付くように表示する（視認性が確保できる余白を保持）。
- FR-003: 同一画面内で番号は一意であり、重複・欠番・重なりがないこと。
- FR-004: スクロール、フィルタ、並び替え、遅延読み込み後も番号表示が崩れないこと。
- FR-005: 採番ポリシーは「項目定義ごとに不変の固定ID」とし、並び替えやフィルタの有無に関わらず番号は変化しない。
- FR-006: 採番範囲はOCR結果表示画面全体での通し番号とし、タブ/セクション/ページを跨いでも連続させる（同一画面内で一意）。
- FR-007: 番号は画面表示に加え、印刷物およびエクスポート（PDF/CSV等）の出力にも含め、画面表示の番号と整合する。
- FR-008: アクセシビリティ対応として、スクリーンリーダーで番号→ラベル→値の順に読み上げられること（視覚障害のある利用者が参照可能）。
- FR-009: ローカライズ：番号の表記は半角アラビア数字で統一し、言語設定に依存せず同一の見え方を保つ。
- FR-010: 既存の画面操作を妨げない（クリック領域などの操作性が低下しない）。
- FR-011: ユーザーの特別な設定や操作なしに既定で番号が表示される。

### Acceptance Criteria (Summary)

- AC-001 (FR-001): 初期表示で全ての可視項目の左横に1からの番号が表示される。
- AC-002 (FR-002/FR-010): 番号表示によりクリック領域が阻害されず、ラベル/値と視覚的に紐づく。
- AC-003 (FR-003): 同一画面で番号の重複・欠番・重なりがない。
- AC-004 (FR-004): 並び替え/フィルタ/遅延読み込み後も番号が崩れない（1秒以内に安定）。
- AC-005 (FR-008): スクリーンリーダーで番号→ラベル→値の順に読み上げられる。
- AC-006 (FR-009): 数字表記は常に半角アラビア数字で表示される。
- AC-007 (FR-011): 追加の設定不要で常時表示される。
- AC-008 (FR-006): タブやセクションを跨いでも番号が連続し、一意性が保たれる。
- AC-009 (FR-007): 印刷/PDF/CSV出力に番号が含まれ、画面表示の番号と一致する。

### Key Entities *(include if feature involves data)*

- Display Item（表示項目）: 画面に表示される単一の項目（ラベル、値、表示順、所属セクションのメタ情報を持つ）。
- Section（セクション/タブ/ページ）: 複数の表示項目を内包するコンテナ。採番範囲の単位となり得る。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- SC-001: 初期表示時点で、可視項目の100%に重複のない番号が表示される。
- SC-002: フィルタ/並び替え/遅延読み込み後、95%のケースで1秒以内に番号表示が安定する（重複・欠番・重なりなし）。
- SC-003: 最小幅320px相当の画面でも、番号とラベル/値の重なりが0件である（主要画面/主要レイアウトの検証にて）。
- SC-004: 受け入れテストで、被験者の90%以上が「番号により項目参照が容易になった」と回答する。

## Assumptions & Dependencies (optional)

- Assumption: 本機能の主目的は画面上での参照性向上であり、印刷/エクスポートへの反映は別途要確認（FR-007の決定に依存）。
- Assumption: 採番ポリシーの最終決定はプロダクトオーナー/現場運用の合意に依存（FR-005/FR-006）。
- Dependency: 既存のOCR結果表示画面の項目メタ情報（表示順/セクション情報）が取得可能であること。
- Dependency: アクセシビリティ方針（読み上げ順/代替テキスト）に準拠できること。
