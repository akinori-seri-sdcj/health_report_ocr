# 機能仕様: OCR結果表示画面に項目番号を表示

## 概要 / 背景
OCR結果表示画面にて、各表示項目（ラベル＋値）の左横に連番の「項目番号」を表示し、利用者が参照・指示・レビューをしやすくします。これにより「3番の血圧を修正してください」のようなコミュニケーションや、QA・確認作業の効率が向上します。

## 目的（Why）
- 項目の参照性を高め、指示や問い合わせを円滑化する
- 作業時間の短縮（口頭・チャットでの位置説明を不要にする）
- レビュー・ダブルチェック時の整合性向上

## スコープ（What）
- 対象画面: 「OCR結果表示画面」
- 対象要素: 画面上に表示される各「項目（行）」の左横に番号を付与
- 採番対象: 「最下層の項目行」のみ（見出し・グループ見出しは対象外）
- 連番方式: 現在の可視順（フィルタ/並び替え/ページング後の画面上の並び）に従い、表示範囲で 1 から採番し、表示更新に追従
- 表示専用: 番号は非インタラクティブで、既存の操作性に影響を与えない
- 外部出力: 印刷・エクスポート・コピーにも番号を含める

## 非スコープ（Out of Scope）
- OCR処理ロジック・認識精度の改善
- 項目の並び順ロジックの新規変更（既存の並び順を前提）

## 想定利用者（Actors）
- 一般利用者／オペレーター: OCR結果を閲覧・確認・修正する人
- レビュワー／管理者: 確認指示やレビューを行う人

## 前提・仮定（Assumptions）
- 画面には「項目（行）」として識別可能な単位でラベルと値が表示される
- 画面の並び順は既存仕様に準拠し、表示再描画時に反映される
- 日本語利用を主とし、数字は半角アラビア数字（1, 2, 3, ...）で表示する
- 一覧の件数は一般的な医療レポート規模（〜50項目程度）を想定
- ページングがある場合、各ページの可視範囲で 1 から再採番する

## 決定事項（Clarifications Resolved）
- 採番の対象範囲: 「最下層の項目行」のみ採番（見出し・グループ見出しは採番しない）
- 採番の基準: 現在の可視順（画面上の並び）に従い再採番（ページングがある場合は各ページで 1 から）
- 外部出力への反映: 印刷・エクスポート・コピーの全てに番号を含める

## ユーザーシナリオ & 受け入れテスト
1) 基本表示
   - 条件: OCR結果表示画面に5項目が表示されている
   - 期待: 左から順に「1, 2, 3, 4, 5」が各項目行の左横に表示される
   - 期待: 各番号はラベルと視覚的に一体化せず、適切な余白で判別可能

2) 表示更新（項目の増減）
   - 条件: 3番目の項目が削除され、4・5番が繰り上がる
   - 期待: 表示更新後に「1, 2, 3, 4」と連番が再採番される（欠番がない）

3) 並び替え/フィルタ（存在する場合）
   - 条件: 表示順が変更される、または一部項目が非表示となる
   - 期待: 現在の可視順に従って 1 から連番で再採番される

3.1) ページング（存在する場合）
   - 条件: ページサイズ N でページング表示
   - 期待: 各ページの可視範囲で 1 から採番（ページを跨いで番号は引き継がない）

4) レイアウト耐性（モバイル/デスクトップ）
   - 条件: 320px 幅の小画面、デスクトップ、200% ズーム
   - 期待: 番号が折り返し・重なり・欠けなく表示され、可読性を維持

5) アクセシビリティ（スクリーンリーダー）
   - 条件: スクリーンリーダーで項目を読み上げ
   - 期待: 「番号 → ラベル → 値」の順で読み上げられ、番号が識別可能

6) 空リスト
   - 条件: 表示項目が0件
   - 期待: 番号は表示されない（余白や不自然な記号が出ない）

## 機能要件（Functional Requirements）
- FR1: OCR結果表示画面の各「項目行」の左横に、1から始まる連番を表示する
- FR2: 連番はユーザーに見える表示順（可視順）に追従し、表示更新時に即時反映される
- FR3: 番号表示は非インタラクティブで、既存の操作（クリック・編集等）を妨げない
- FR4: 最小でも WCAGに準じた視認性（十分なコントラスト・余白）を確保する
- FR5: スクリーンリーダー利用時、番号→ラベル→値の順で読み上げられるようにする
- FR6: 数字は半角アラビア数字（1, 2, 3, ...）で統一する
- FR7: 項目が0件の場合、番号は表示しない
- FR8: ラベル欠落や長文の折返しがあっても番号の視認性と整列を維持する
- FR9: 印刷・エクスポート・コピーにおいても項目番号を含めて出力する
- FR10: ページングがある場合、各ページの可視範囲で 1 から採番する

## 非機能要件（品質）
- パフォーマンス: 一般的なレポート規模（〜50項目）で、初回表示および更新時に体感遅延が発生しない（利用者は1秒以内に項目が表示されたと感じる）
- レイアウト安定性: 番号追加により重大なレイアウト崩れや操作障害が発生しない
- アクセシビリティ: キーボード操作・読み上げで番号が理解可能

## 成功基準（Success Criteria）
- 参照性: ユーザビリティテストで「番号を使って項目を指示できる」達成率が90%以上
- 可視性: 対応デバイス幅（最小320px）で、95%以上の項目で番号が重なり/欠けなく読める
- 一貫性: 表示更新・並び替え後も欠番/重複なしで連番維持（テストケース全通過）
- 体感速度: 典型的レポート（≤50項目）の初回表示が1秒以内に完了と認識される
 - 出力一貫性: 印刷・エクスポート・コピーの各出力で番号が欠落しないこと（レビュー確認率100%）

## 主要エンティティ（参考）
- 表示項目（行）: { 表示順序, ラベル, 値, 表示可否 }

## 依存関係 / リスク
- 依存: 既存の項目リスト生成・表示ロジック
- リスク: レイアウト崩れ（小画面, 長文。対策: 余白・折返し指針）
- リスク: 並び替え/フィルタ時の採番要件未確定（確認事項で決定）

## 受け入れ基準（Acceptace Criteria）
- AC1: 画面表示時、各項目行の左横に1から始まる連番が表示される
- AC2: 項目の増減・再描画後も欠番/重複なしで連番が維持される
- AC3: 小画面・高倍率でも番号が判読可能でレイアウト破綻がない
- AC4: スクリーンリーダーで番号→ラベル→値の順に読み上げられる
- AC5: 並び替え/フィルタ時の番号の扱いは「可視順で再採番」に一致する
- AC6: ページング時、各ページで 1 から採番される
- AC7: 印刷・エクスポート・コピーの各出力に項目番号が含まれる
7) 外部出力（印刷・エクスポート・コピー）
   - 条件: 画面から印刷、エクスポート、テキストコピーを実行
   - 期待: 出力先すべてにおいて項目番号が欠落せず含まれる

