"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ocr/route";
exports.ids = ["app/api/ocr/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr%2Froute&page=%2Fapi%2Focr%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr%2Froute.ts&appDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr%2Froute&page=%2Fapi%2Focr%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr%2Froute.ts&appDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_aseri_Desktop_health_report_ocr_app_api_ocr_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ocr/route.ts */ \"(rsc)/./app/api/ocr/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ocr/route\",\n        pathname: \"/api/ocr\",\n        filename: \"route\",\n        bundlePath: \"app/api/ocr/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\aseri\\\\Desktop\\\\health_report_ocr\\\\app\\\\api\\\\ocr\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_aseri_Desktop_health_report_ocr_app_api_ocr_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ocr/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZvY3IlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9jciUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9jciUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNhc2VyaSU1Q0Rlc2t0b3AlNUNoZWFsdGhfcmVwb3J0X29jciU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDYXNlcmklNUNEZXNrdG9wJTVDaGVhbHRoX3JlcG9ydF9vY3ImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3FCO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaGVhbHRoLXJlcG9ydC1vY3IvPzljYTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcYXNlcmlcXFxcRGVza3RvcFxcXFxoZWFsdGhfcmVwb3J0X29jclxcXFxhcHBcXFxcYXBpXFxcXG9jclxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvb2NyL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvb2NyXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9vY3Ivcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxhc2VyaVxcXFxEZXNrdG9wXFxcXGhlYWx0aF9yZXBvcnRfb2NyXFxcXGFwcFxcXFxhcGlcXFxcb2NyXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9vY3Ivcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr%2Froute&page=%2Fapi%2Focr%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr%2Froute.ts&appDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/ocr/route.ts":
/*!******************************!*\
  !*** ./app/api/ocr/route.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _shared_health_report_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../shared/health-report.schema */ \"(rsc)/./shared/health-report.schema.ts\");\n\n\n\nconst runtime = \"nodejs\";\n// Upload constraints: keep serverless-friendly to avoid timeouts and memory blowups\nconst MAX_FILE_SIZE = 10 * 1024 * 1024 // 10MB\n;\nconst MAX_FILES = 10;\nconst TIMEOUT_MS = Number(process.env.OCR_TIMEOUT_MS || 45000) // configurable; default 45s for local dev\n;\nconst ALLOWED_MIME_TYPES = [\n    \"image/jpeg\",\n    \"image/jpg\",\n    \"image/png\",\n    \"image/webp\",\n    \"image/heic\",\n    \"image/heif\"\n];\nconst USE_MOCK_OCR = !process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY.startsWith(\"sk-your-\") || process.env.MOCK_OCR === \"1\";\nconst SYSTEM_PROMPT = `あなたは優秀なデータ入力アシスタントです。\n提供された複数の健康診断結果の画像から、記載されている情報を正確に読み取り、指定されたJSON形式で出力してください。\n\n# 制約条件\n\n- 画像に記載されている**上から下の順序を維持して**、検査結果の配列に要素を追加してください。原本と突き合わせて確認する作業で順序が重要になります。\n- 帳票に記載されている全ての検査項目を、漏れなく抽出してください。項目名、値、単位、判定のセットを1つとして扱ってください。\n- 項目名は、画像に書かれている表記をできるだけそのまま使用してください。\n- **判定フィールドは非常に重要です。** 「A」「B」「C」「D」「D2」などのアルファベットや記号が記載されている場合、必ずそのまま抽出してください。空欄の場合のみ null を設定してください。\n- 値や単位が空欄の項目は、該当するキーの値を null としてください。\n- **氏名や受診日が健康診断結果に記載されていない場合は、null を設定してください。** 全ての健康診断結果に氏名が含まれているわけではありません。\n- JSON以外の説明や前置きは一切不要です。JSONオブジェクトのみを出力してください。\n\n# 判定の抽出について\n\n判定は通常、以下のような形式で記載されています：\n- アルファベット1文字: A, B, C, D, E など\n- アルファベット+数字: D1, D2, E1 など\n- 記号: ○, ×, △ など\n- 空欄の場合のみ null\n\n**重要**: 判定列に何らかの文字や記号が書かれている場合は、必ずその値を抽出してください。\n\n# 出力フォーマット（JSON）\n\n{\n  \"受診者情報\": {\n    \"氏名\": \"string | null (健康診断結果に記載がない場合は null)\",\n    \"受診日\": \"string | null (YYYY-MM-DD形式を推奨、記載がない場合は null)\"\n  },\n  \"検査結果\": [\n    {\n      \"項目名\": \"string (例: 身長, 体重, LDLコレステロール)\",\n      \"値\": \"string (例: 170.5, 65.2, 145)\",\n      \"単位\": \"string | null (例: cm, kg, mg/dL)\",\n      \"判定\": \"string | null (例: A, B, C, D, D2, ○, ×)\"\n    }\n  ],\n  \"総合所見\": {\n    \"総合判定\": \"string | null (例: A, D2)\",\n    \"医師の所見\": \"string | null\"\n  }\n}\n\n# 出力例\n\n## 例1: 氏名・受診日が記載されている場合\n{\n  \"受診者情報\": {\n    \"氏名\": \"山田太郎\",\n    \"受診日\": \"2025-10-03\"\n  },\n  \"検査結果\": [\n    {\n      \"項目名\": \"身長\",\n      \"値\": \"170.5\",\n      \"単位\": \"cm\",\n      \"判定\": \"A\"\n    },\n    {\n      \"項目名\": \"LDLコレステロール\",\n      \"値\": \"145\",\n      \"単位\": \"mg/dL\",\n      \"判定\": \"D2\"\n    }\n  ],\n  \"総合所見\": {\n    \"総合判定\": \"D2\",\n    \"医師の所見\": \"血圧、脂質について精密検査を受けてください。\"\n  }\n}\n\n## 例2: 氏名・受診日が記載されていない場合\n{\n  \"受診者情報\": {\n    \"氏名\": null,\n    \"受診日\": null\n  },\n  \"検査結果\": [\n    {\n      \"項目名\": \"身長\",\n      \"値\": \"170.5\",\n      \"単位\": \"cm\",\n      \"判定\": \"A\"\n    }\n  ],\n  \"総合所見\": {\n    \"総合判定\": null,\n    \"医師の所見\": null\n  }\n}`;\nasync function POST(req) {\n    if (!req.headers.get(\"content-type\")?.includes(\"multipart/form-data\")) {\n        return jsonError(400, \"INVALID_CONTENT_TYPE\", \"multipart/form-data で送信してください。\", {\n            hint: \"フォームデータで images フィールドに画像を付与してください。\"\n        });\n    }\n    try {\n        const formData = await req.formData();\n        const files = formData.getAll(\"images\").filter((f)=>f instanceof File);\n        if (!files.length) {\n            return jsonError(400, \"NO_FILES_UPLOADED\", \"画像ファイルが送信されていません。\", {\n                hint: \"images フィールドに1枚以上の画像を添付してください。\"\n            });\n        }\n        if (files.length > MAX_FILES) {\n            return jsonError(400, \"TOO_MANY_FILES\", `最大${MAX_FILES}枚までアップロード可能です。`, {\n                hint: \"枚数を減らして再送してください。\"\n            });\n        }\n        const uploads = [];\n        for (const file of files){\n            if (!ALLOWED_MIME_TYPES.includes(file.type)) {\n                return jsonError(400, \"UNSUPPORTED_MEDIA_TYPE\", `サポートされていないファイル形式です。許可: ${ALLOWED_MIME_TYPES.join(\", \")}`, {\n                    hint: \"対応形式の画像で再送してください。\"\n                });\n            }\n            if (file.size > MAX_FILE_SIZE) {\n                return jsonError(400, \"FILE_TOO_LARGE\", `ファイルサイズが上限(${MAX_FILE_SIZE / (1024 * 1024)}MB)を超えています。`, {\n                    hint: \"画像を圧縮するか、サイズを小さくして再送してください。\"\n                });\n            }\n            const buffer = Buffer.from(await file.arrayBuffer());\n            uploads.push({\n                buffer,\n                mimetype: file.type,\n                size: file.size,\n                originalname: file.name\n            });\n        }\n        const data = await performOcr(uploads);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"OCR API error\", error);\n        const message = error instanceof Error ? error.message : \"健康診断結果の抽出に失敗しました。\";\n        return jsonError(500, \"OCR_PROCESSING_ERROR\", message, {\n            traceId: crypto.randomUUID?.() || undefined,\n            retryable: USE_MOCK_OCR ? false : true\n        });\n    }\n}\nasync function performOcr(files) {\n    if (USE_MOCK_OCR) {\n        console.warn(\"USE_MOCK_OCR is enabled. Returning mock OCR results.\");\n        const sample = {\n            [\"受診者情報\"]: {\n                [\"氏名\"]: null,\n                [\"受診日\"]: null\n            },\n            [\"検査結果\"]: [\n                {\n                    [\"項目名\"]: \"身長\",\n                    [\"値\"]: \"170.5\",\n                    [\"単位\"]: \"cm\",\n                    [\"判定\"]: \"A\"\n                },\n                {\n                    [\"項目名\"]: \"体重\",\n                    [\"値\"]: \"65.2\",\n                    [\"単位\"]: \"kg\",\n                    [\"判定\"]: \"A\"\n                },\n                {\n                    [\"項目名\"]: \"LDLコレステロール\",\n                    [\"値\"]: \"145\",\n                    [\"単位\"]: \"mg/dL\",\n                    [\"判定\"]: \"D2\"\n                }\n            ],\n            [\"総合所見\"]: {\n                [\"総合判定\"]: \"A\",\n                [\"医師のコメント\"]: null\n            }\n        };\n        return sample;\n    }\n    if (!process.env.OPENAI_API_KEY) {\n        throw new Error(\"OPENAI_API_KEY が設定されていません。MOCK_OCR=1 でのみキーなし動作が許可されます。\");\n    }\n    const openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n        apiKey: process.env.OPENAI_API_KEY,\n        timeout: TIMEOUT_MS\n    });\n    // Vercel serverlessは実行時間に制限があるため、モデル選定や画像枚数に応じてタイムアウト/フォールバックを別途検討する\n    const imageContents = files.map((file)=>{\n        const base64Image = file.buffer.toString(\"base64\");\n        return {\n            type: \"image_url\",\n            image_url: {\n                url: `data:${file.mimetype};base64,${base64Image}`,\n                detail: \"high\"\n            }\n        };\n    });\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), TIMEOUT_MS);\n    let response;\n    try {\n        response = await openai.chat.completions.create({\n            model: \"gpt-4o\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: SYSTEM_PROMPT\n                },\n                {\n                    role: \"user\",\n                    content: [\n                        {\n                            type: \"text\",\n                            text: \"以下の健康診断結果の画像から、指定されたJSON形式でデータを抽出してください。\"\n                        },\n                        ...imageContents\n                    ]\n                }\n            ],\n            response_format: {\n                type: \"json_object\"\n            },\n            max_tokens: 4096,\n            temperature: 0\n        }, {\n            signal: controller.signal\n        });\n    } catch (error) {\n        if (error?.name === \"AbortError\") {\n            throw new Error(\"OCR処理がタイムアウトしました。画像枚数やサイズを減らすか、MOCK_OCR=1で切り分けてください。\");\n        }\n        throw error;\n    } finally{\n        clearTimeout(timeout);\n    }\n    const content = response.choices[0]?.message?.content;\n    if (!content) {\n        throw new Error(\"OpenAI APIからのレスポンスが空です。\");\n    }\n    const parsedData = JSON.parse(content);\n    return (0,_shared_health_report_schema__WEBPACK_IMPORTED_MODULE_1__.validateHealthReportData)(parsedData);\n}\nfunction jsonError(status, code, message, meta) {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: false,\n        error: {\n            code,\n            message,\n            ...meta\n        }\n    }, {\n        status\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxTQUFTO1FBQ1RFLE9BQU87WUFDTDJDO1lBQ0F6QztZQUNBLEdBQUcwQyxJQUFJO1FBQ1Q7SUFDRixHQUNBO1FBQUU3QztJQUFPO0FBRWIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZWFsdGgtcmVwb3J0LW9jci8uL2FwcC9hcGkvb2NyL3JvdXRlLnRzPzQ1ZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQge1xuICBIZWFsdGhSZXBvcnREYXRhLFxuICB2YWxpZGF0ZUhlYWx0aFJlcG9ydERhdGEsXG59IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9oZWFsdGgtcmVwb3J0LnNjaGVtYSdcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSAnbm9kZWpzJ1xuXG50eXBlIFVwbG9hZGVkRmlsZSA9IHtcbiAgYnVmZmVyOiBCdWZmZXJcbiAgbWltZXR5cGU6IHN0cmluZ1xuICBzaXplOiBudW1iZXJcbiAgb3JpZ2luYWxuYW1lOiBzdHJpbmdcbn1cblxuLy8gVXBsb2FkIGNvbnN0cmFpbnRzOiBrZWVwIHNlcnZlcmxlc3MtZnJpZW5kbHkgdG8gYXZvaWQgdGltZW91dHMgYW5kIG1lbW9yeSBibG93dXBzXG5jb25zdCBNQVhfRklMRV9TSVpFID0gMTAgKiAxMDI0ICogMTAyNCAvLyAxME1CXG5jb25zdCBNQVhfRklMRVMgPSAxMFxuY29uc3QgVElNRU9VVF9NUyA9IE51bWJlcihwcm9jZXNzLmVudi5PQ1JfVElNRU9VVF9NUyB8fCA0NV8wMDApIC8vIGNvbmZpZ3VyYWJsZTsgZGVmYXVsdCA0NXMgZm9yIGxvY2FsIGRldlxuY29uc3QgQUxMT1dFRF9NSU1FX1RZUEVTID0gW1xuICAnaW1hZ2UvanBlZycsXG4gICdpbWFnZS9qcGcnLFxuICAnaW1hZ2UvcG5nJyxcbiAgJ2ltYWdlL3dlYnAnLFxuICAnaW1hZ2UvaGVpYycsXG4gICdpbWFnZS9oZWlmJyxcbl1cblxuY29uc3QgVVNFX01PQ0tfT0NSID1cbiAgIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZIHx8XG4gIHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLnN0YXJ0c1dpdGgoJ3NrLXlvdXItJykgfHxcbiAgcHJvY2Vzcy5lbnYuTU9DS19PQ1IgPT09ICcxJ1xuXG5jb25zdCBTWVNURU1fUFJPTVBUID0gYOOBguOBquOBn+OBr+WEquengOOBquODh+ODvOOCv+WFpeWKm+OCouOCt+OCueOCv+ODs+ODiOOBp+OBmeOAglxu5o+Q5L6b44GV44KM44Gf6KSH5pWw44Gu5YGl5bq36Ki65pat57WQ5p6c44Gu55S75YOP44GL44KJ44CB6KiY6LyJ44GV44KM44Gm44GE44KL5oOF5aCx44KS5q2j56K644Gr6Kqt44G/5Y+W44KK44CB5oyH5a6a44GV44KM44GfSlNPTuW9ouW8j+OBp+WHuuWKm+OBl+OBpuOBj+OBoOOBleOBhOOAglxuXG4jIOWItue0hOadoeS7tlxuXG4tIOeUu+WDj+OBq+iomOi8ieOBleOCjOOBpuOBhOOCiyoq5LiK44GL44KJ5LiL44Gu6aCG5bqP44KS57at5oyB44GX44GmKirjgIHmpJzmn7vntZDmnpzjga7phY3liJfjgavopoHntKDjgpLov73liqDjgZfjgabjgY/jgaDjgZXjgYTjgILljp/mnKzjgajnqoHjgY3lkIjjgo/jgZvjgabnorroqo3jgZnjgovkvZzmpa3jgafpoIbluo/jgYzph43opoHjgavjgarjgorjgb7jgZnjgIJcbi0g5biz56Wo44Gr6KiY6LyJ44GV44KM44Gm44GE44KL5YWo44Gm44Gu5qSc5p+76aCF55uu44KS44CB5ryP44KM44Gq44GP5oq95Ye644GX44Gm44GP44Gg44GV44GE44CC6aCF55uu5ZCN44CB5YCk44CB5Y2Y5L2N44CB5Yik5a6a44Gu44K744OD44OI44KSMeOBpOOBqOOBl+OBpuaJseOBo+OBpuOBj+OBoOOBleOBhOOAglxuLSDpoIXnm67lkI3jga/jgIHnlLvlg4/jgavmm7jjgYvjgozjgabjgYTjgovooajoqJjjgpLjgafjgY3jgovjgaDjgZHjgZ3jga7jgb7jgb7kvb/nlKjjgZfjgabjgY/jgaDjgZXjgYTjgIJcbi0gKirliKTlrprjg5XjgqPjg7zjg6vjg4njga/pnZ7luLjjgavph43opoHjgafjgZnjgIIqKiDjgIxB44CN44CMQuOAjeOAjEPjgI3jgIxE44CN44CMRDLjgI3jgarjganjga7jgqLjg6vjg5XjgqHjg5njg4Pjg4jjgoToqJjlj7fjgYzoqJjovInjgZXjgozjgabjgYTjgovloLTlkIjjgIHlv4XjgZrjgZ3jga7jgb7jgb7mir3lh7rjgZfjgabjgY/jgaDjgZXjgYTjgILnqbrmrITjga7loLTlkIjjga7jgb8gbnVsbCDjgpLoqK3lrprjgZfjgabjgY/jgaDjgZXjgYTjgIJcbi0g5YCk44KE5Y2Y5L2N44GM56m65qyE44Gu6aCF55uu44Gv44CB6Kmy5b2T44GZ44KL44Kt44O844Gu5YCk44KSIG51bGwg44Go44GX44Gm44GP44Gg44GV44GE44CCXG4tICoq5rCP5ZCN44KE5Y+X6Ki65pel44GM5YGl5bq36Ki65pat57WQ5p6c44Gr6KiY6LyJ44GV44KM44Gm44GE44Gq44GE5aC05ZCI44Gv44CBbnVsbCDjgpLoqK3lrprjgZfjgabjgY/jgaDjgZXjgYTjgIIqKiDlhajjgabjga7lgaXlurfoqLrmlq3ntZDmnpzjgavmsI/lkI3jgYzlkKvjgb7jgozjgabjgYTjgovjgo/jgZHjgafjga/jgYLjgorjgb7jgZvjgpPjgIJcbi0gSlNPTuS7peWkluOBruiqrOaYjuOChOWJjee9ruOBjeOBr+S4gOWIh+S4jeimgeOBp+OBmeOAgkpTT07jgqrjg5bjgrjjgqfjgq/jg4jjga7jgb/jgpLlh7rlipvjgZfjgabjgY/jgaDjgZXjgYTjgIJcblxuIyDliKTlrprjga7mir3lh7rjgavjgaTjgYTjgaZcblxu5Yik5a6a44Gv6YCa5bi444CB5Lul5LiL44Gu44KI44GG44Gq5b2i5byP44Gn6KiY6LyJ44GV44KM44Gm44GE44G+44GZ77yaXG4tIOOCouODq+ODleOCoeODmeODg+ODiDHmloflrZc6IEEsIEIsIEMsIEQsIEUg44Gq44GpXG4tIOOCouODq+ODleOCoeODmeODg+ODiCvmlbDlrZc6IEQxLCBEMiwgRTEg44Gq44GpXG4tIOiomOWPtzog4peLLCDDlywg4pazIOOBquOBqVxuLSDnqbrmrITjga7loLTlkIjjga7jgb8gbnVsbFxuXG4qKumHjeimgSoqOiDliKTlrprliJfjgavkvZXjgonjgYvjga7mloflrZfjgoToqJjlj7fjgYzmm7jjgYvjgozjgabjgYTjgovloLTlkIjjga/jgIHlv4XjgZrjgZ3jga7lgKTjgpLmir3lh7rjgZfjgabjgY/jgaDjgZXjgYTjgIJcblxuIyDlh7rlipvjg5Xjgqnjg7zjg57jg4Pjg4jvvIhKU09O77yJXG5cbntcbiAgXCLlj5foqLrogIXmg4XloLFcIjoge1xuICAgIFwi5rCP5ZCNXCI6IFwic3RyaW5nIHwgbnVsbCAo5YGl5bq36Ki65pat57WQ5p6c44Gr6KiY6LyJ44GM44Gq44GE5aC05ZCI44GvIG51bGwpXCIsXG4gICAgXCLlj5foqLrml6VcIjogXCJzdHJpbmcgfCBudWxsIChZWVlZLU1NLURE5b2i5byP44KS5o6o5aWo44CB6KiY6LyJ44GM44Gq44GE5aC05ZCI44GvIG51bGwpXCJcbiAgfSxcbiAgXCLmpJzmn7vntZDmnpxcIjogW1xuICAgIHtcbiAgICAgIFwi6aCF55uu5ZCNXCI6IFwic3RyaW5nICjkvos6IOi6q+mVtywg5L2T6YeNLCBMREzjgrPjg6zjgrnjg4bjg63jg7zjg6spXCIsXG4gICAgICBcIuWApFwiOiBcInN0cmluZyAo5L6LOiAxNzAuNSwgNjUuMiwgMTQ1KVwiLFxuICAgICAgXCLljZjkvY1cIjogXCJzdHJpbmcgfCBudWxsICjkvos6IGNtLCBrZywgbWcvZEwpXCIsXG4gICAgICBcIuWIpOWumlwiOiBcInN0cmluZyB8IG51bGwgKOS+izogQSwgQiwgQywgRCwgRDIsIOKXiywgw5cpXCJcbiAgICB9XG4gIF0sXG4gIFwi57eP5ZCI5omA6KaLXCI6IHtcbiAgICBcIue3j+WQiOWIpOWumlwiOiBcInN0cmluZyB8IG51bGwgKOS+izogQSwgRDIpXCIsXG4gICAgXCLljLvluKvjga7miYDopotcIjogXCJzdHJpbmcgfCBudWxsXCJcbiAgfVxufVxuXG4jIOWHuuWKm+S+i1xuXG4jIyDkvosxOiDmsI/lkI3jg7vlj5foqLrml6XjgYzoqJjovInjgZXjgozjgabjgYTjgovloLTlkIhcbntcbiAgXCLlj5foqLrogIXmg4XloLFcIjoge1xuICAgIFwi5rCP5ZCNXCI6IFwi5bGx55Sw5aSq6YOOXCIsXG4gICAgXCLlj5foqLrml6VcIjogXCIyMDI1LTEwLTAzXCJcbiAgfSxcbiAgXCLmpJzmn7vntZDmnpxcIjogW1xuICAgIHtcbiAgICAgIFwi6aCF55uu5ZCNXCI6IFwi6Lqr6ZW3XCIsXG4gICAgICBcIuWApFwiOiBcIjE3MC41XCIsXG4gICAgICBcIuWNmOS9jVwiOiBcImNtXCIsXG4gICAgICBcIuWIpOWumlwiOiBcIkFcIlxuICAgIH0sXG4gICAge1xuICAgICAgXCLpoIXnm67lkI1cIjogXCJMREzjgrPjg6zjgrnjg4bjg63jg7zjg6tcIixcbiAgICAgIFwi5YCkXCI6IFwiMTQ1XCIsXG4gICAgICBcIuWNmOS9jVwiOiBcIm1nL2RMXCIsXG4gICAgICBcIuWIpOWumlwiOiBcIkQyXCJcbiAgICB9XG4gIF0sXG4gIFwi57eP5ZCI5omA6KaLXCI6IHtcbiAgICBcIue3j+WQiOWIpOWumlwiOiBcIkQyXCIsXG4gICAgXCLljLvluKvjga7miYDopotcIjogXCLooYDlnKfjgIHohILos6rjgavjgaTjgYTjgabnsr7lr4bmpJzmn7vjgpLlj5fjgZHjgabjgY/jgaDjgZXjgYTjgIJcIlxuICB9XG59XG5cbiMjIOS+izI6IOawj+WQjeODu+WPl+iouuaXpeOBjOiomOi8ieOBleOCjOOBpuOBhOOBquOBhOWgtOWQiFxue1xuICBcIuWPl+iouuiAheaDheWgsVwiOiB7XG4gICAgXCLmsI/lkI1cIjogbnVsbCxcbiAgICBcIuWPl+iouuaXpVwiOiBudWxsXG4gIH0sXG4gIFwi5qSc5p+757WQ5p6cXCI6IFtcbiAgICB7XG4gICAgICBcIumgheebruWQjVwiOiBcIui6q+mVt1wiLFxuICAgICAgXCLlgKRcIjogXCIxNzAuNVwiLFxuICAgICAgXCLljZjkvY1cIjogXCJjbVwiLFxuICAgICAgXCLliKTlrppcIjogXCJBXCJcbiAgICB9XG4gIF0sXG4gIFwi57eP5ZCI5omA6KaLXCI6IHtcbiAgICBcIue3j+WQiOWIpOWumlwiOiBudWxsLFxuICAgIFwi5Yy75bir44Gu5omA6KaLXCI6IG51bGxcbiAgfVxufWBcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBOZXh0UmVxdWVzdCkge1xuICBpZiAoIXJlcS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk/LmluY2x1ZGVzKCdtdWx0aXBhcnQvZm9ybS1kYXRhJykpIHtcbiAgICByZXR1cm4ganNvbkVycm9yKDQwMCwgJ0lOVkFMSURfQ09OVEVOVF9UWVBFJywgJ211bHRpcGFydC9mb3JtLWRhdGEg44Gn6YCB5L+h44GX44Gm44GP44Gg44GV44GE44CCJywge1xuICAgICAgaGludDogJ+ODleOCqeODvOODoOODh+ODvOOCv+OBpyBpbWFnZXMg44OV44Kj44O844Or44OJ44Gr55S75YOP44KS5LuY5LiO44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICB9KVxuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBmb3JtRGF0YSA9IGF3YWl0IHJlcS5mb3JtRGF0YSgpXG4gICAgY29uc3QgZmlsZXMgPSBmb3JtRGF0YS5nZXRBbGwoJ2ltYWdlcycpLmZpbHRlcigoZik6IGYgaXMgRmlsZSA9PiBmIGluc3RhbmNlb2YgRmlsZSlcblxuICAgIGlmICghZmlsZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4ganNvbkVycm9yKDQwMCwgJ05PX0ZJTEVTX1VQTE9BREVEJywgJ+eUu+WDj+ODleOCoeOCpOODq+OBjOmAgeS/oeOBleOCjOOBpuOBhOOBvuOBm+OCk+OAgicsIHtcbiAgICAgICAgaGludDogJ2ltYWdlcyDjg5XjgqPjg7zjg6vjg4njgasx5p6a5Lul5LiK44Gu55S75YOP44KS5re75LuY44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgIH0pXG4gICAgfVxuICAgIGlmIChmaWxlcy5sZW5ndGggPiBNQVhfRklMRVMpIHtcbiAgICAgIHJldHVybiBqc29uRXJyb3IoNDAwLCAnVE9PX01BTllfRklMRVMnLCBg5pyA5aSnJHtNQVhfRklMRVN95p6a44G+44Gn44Ki44OD44OX44Ot44O844OJ5Y+v6IO944Gn44GZ44CCYCwge1xuICAgICAgICBoaW50OiAn5p6a5pWw44KS5rib44KJ44GX44Gm5YaN6YCB44GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgdXBsb2FkczogVXBsb2FkZWRGaWxlW10gPSBbXVxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgaWYgKCFBTExPV0VEX01JTUVfVFlQRVMuaW5jbHVkZXMoZmlsZS50eXBlKSkge1xuICAgICAgICByZXR1cm4ganNvbkVycm9yKFxuICAgICAgICAgIDQwMCxcbiAgICAgICAgICAnVU5TVVBQT1JURURfTUVESUFfVFlQRScsXG4gICAgICAgICAgYOOCteODneODvOODiOOBleOCjOOBpuOBhOOBquOBhOODleOCoeOCpOODq+W9ouW8j+OBp+OBmeOAguioseWPrzogJHtBTExPV0VEX01JTUVfVFlQRVMuam9pbignLCAnKX1gLFxuICAgICAgICAgIHsgaGludDogJ+WvvuW/nOW9ouW8j+OBrueUu+WDj+OBp+WGjemAgeOBl+OBpuOBj+OBoOOBleOBhOOAgicgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICBpZiAoZmlsZS5zaXplID4gTUFYX0ZJTEVfU0laRSkge1xuICAgICAgICByZXR1cm4ganNvbkVycm9yKFxuICAgICAgICAgIDQwMCxcbiAgICAgICAgICAnRklMRV9UT09fTEFSR0UnLFxuICAgICAgICAgIGDjg5XjgqHjgqTjg6vjgrXjgqTjgrrjgYzkuIrpmZAoJHtNQVhfRklMRV9TSVpFIC8gKDEwMjQgKiAxMDI0KX1NQinjgpLotoXjgYjjgabjgYTjgb7jgZnjgIJgLFxuICAgICAgICAgIHsgaGludDogJ+eUu+WDj+OCkuWcp+e4ruOBmeOCi+OBi+OAgeOCteOCpOOCuuOCkuWwj+OBleOBj+OBl+OBpuWGjemAgeOBl+OBpuOBj+OBoOOBleOBhOOAgicgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCkpXG4gICAgICB1cGxvYWRzLnB1c2goe1xuICAgICAgICBidWZmZXIsXG4gICAgICAgIG1pbWV0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgb3JpZ2luYWxuYW1lOiBmaWxlLm5hbWUsXG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwZXJmb3JtT2NyKHVwbG9hZHMpXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGEsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDIwMCB9XG4gICAgKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ09DUiBBUEkgZXJyb3InLCBlcnJvcilcbiAgICBjb25zdCBtZXNzYWdlID1cbiAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgIDogJ+WBpeW6t+iouuaWree1kOaenOOBruaKveWHuuOBq+WkseaVl+OBl+OBvuOBl+OBn+OAgidcbiAgICByZXR1cm4ganNvbkVycm9yKFxuICAgICAgNTAwLFxuICAgICAgJ09DUl9QUk9DRVNTSU5HX0VSUk9SJyxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB7XG4gICAgICAgIHRyYWNlSWQ6IGNyeXB0by5yYW5kb21VVUlEPy4oKSB8fCB1bmRlZmluZWQsXG4gICAgICAgIHJldHJ5YWJsZTogVVNFX01PQ0tfT0NSID8gZmFsc2UgOiB0cnVlLFxuICAgICAgfVxuICAgIClcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtT2NyKGZpbGVzOiBVcGxvYWRlZEZpbGVbXSk6IFByb21pc2U8SGVhbHRoUmVwb3J0RGF0YT4ge1xuICBpZiAoVVNFX01PQ0tfT0NSKSB7XG4gICAgY29uc29sZS53YXJuKCdVU0VfTU9DS19PQ1IgaXMgZW5hYmxlZC4gUmV0dXJuaW5nIG1vY2sgT0NSIHJlc3VsdHMuJylcbiAgICBjb25zdCBzYW1wbGU6IEhlYWx0aFJlcG9ydERhdGEgPSB7XG4gICAgICBbJ+WPl+iouuiAheaDheWgsSddOiB7XG4gICAgICAgIFsn5rCP5ZCNJ106IG51bGwsXG4gICAgICAgIFsn5Y+X6Ki65pelJ106IG51bGwsXG4gICAgICB9IGFzIGFueSxcbiAgICAgIFsn5qSc5p+757WQ5p6cJ106IFtcbiAgICAgICAgeyBbJ+mgheebruWQjSddOiAn6Lqr6ZW3JywgWyflgKQnXTogJzE3MC41JywgWyfljZjkvY0nXTogJ2NtJywgWyfliKTlrponXTogJ0EnIH0gYXMgYW55LFxuICAgICAgICB7IFsn6aCF55uu5ZCNJ106ICfkvZPph40nLCBbJ+WApCddOiAnNjUuMicsIFsn5Y2Y5L2NJ106ICdrZycsIFsn5Yik5a6aJ106ICdBJyB9IGFzIGFueSxcbiAgICAgICAgeyBbJ+mgheebruWQjSddOiAnTERM44Kz44Os44K544OG44Ot44O844OrJywgWyflgKQnXTogJzE0NScsIFsn5Y2Y5L2NJ106ICdtZy9kTCcsIFsn5Yik5a6aJ106ICdEMicgfSBhcyBhbnksXG4gICAgICBdIGFzIGFueSxcbiAgICAgIFsn57eP5ZCI5omA6KaLJ106IHtcbiAgICAgICAgWyfnt4/lkIjliKTlrponXTogJ0EnLFxuICAgICAgICBbJ+WMu+W4q+OBruOCs+ODoeODs+ODiCddOiBudWxsLFxuICAgICAgfSBhcyBhbnksXG4gICAgfSBhcyBhbnlcbiAgICByZXR1cm4gc2FtcGxlXG4gIH1cblxuICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdPUEVOQUlfQVBJX0tFWSDjgYzoqK3lrprjgZXjgozjgabjgYTjgb7jgZvjgpPjgIJNT0NLX09DUj0xIOOBp+OBruOBv+OCreODvOOBquOBl+WLleS9nOOBjOioseWPr+OBleOCjOOBvuOBmeOAgicpXG4gIH1cblxuICBjb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxuICAgIHRpbWVvdXQ6IFRJTUVPVVRfTVMsIC8vIGFib3J0IGlmIFNESy1sZXZlbCB0aW1lb3V0IGlzIGhpdFxuICB9KVxuXG4gIC8vIFZlcmNlbCBzZXJ2ZXJsZXNz44Gv5a6f6KGM5pmC6ZaT44Gr5Yi26ZmQ44GM44GC44KL44Gf44KB44CB44Oi44OH44Or6YG45a6a44KE55S75YOP5p6a5pWw44Gr5b+c44GY44Gm44K/44Kk44Og44Ki44Km44OIL+ODleOCqeODvOODq+ODkOODg+OCr+OCkuWIpemAlOaknOiojuOBmeOCi1xuICBjb25zdCBpbWFnZUNvbnRlbnRzID0gZmlsZXMubWFwKGZpbGUgPT4ge1xuICAgIGNvbnN0IGJhc2U2NEltYWdlID0gZmlsZS5idWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdpbWFnZV91cmwnIGFzIGNvbnN0LFxuICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgIHVybDogYGRhdGE6JHtmaWxlLm1pbWV0eXBlfTtiYXNlNjQsJHtiYXNlNjRJbWFnZX1gLFxuICAgICAgICBkZXRhaWw6ICdoaWdoJyBhcyBjb25zdCxcbiAgICAgIH0sXG4gICAgfVxuICB9KVxuXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKClcbiAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCBUSU1FT1VUX01TKVxuXG4gIGxldCByZXNwb25zZVxuICB0cnkge1xuICAgIHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKFxuICAgICAge1xuICAgICAgICBtb2RlbDogJ2dwdC00bycsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3N5c3RlbScsXG4gICAgICAgICAgICBjb250ZW50OiBTWVNURU1fUFJPTVBULFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICfku6XkuIvjga7lgaXlurfoqLrmlq3ntZDmnpzjga7nlLvlg4/jgYvjgonjgIHmjIflrprjgZXjgozjgZ9KU09O5b2i5byP44Gn44OH44O844K/44KS5oq95Ye644GX44Gm44GP44Gg44GV44GE44CCJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgLi4uaW1hZ2VDb250ZW50cyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6ICdqc29uX29iamVjdCcgfSxcbiAgICAgICAgbWF4X3Rva2VuczogNDA5NixcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAsXG4gICAgICB9LFxuICAgICAgeyBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsIH1cbiAgICApXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKChlcnJvciBhcyBhbnkpPy5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT0NS5Yem55CG44GM44K/44Kk44Og44Ki44Km44OI44GX44G+44GX44Gf44CC55S75YOP5p6a5pWw44KE44K144Kk44K644KS5rib44KJ44GZ44GL44CBTU9DS19PQ1I9MeOBp+WIh+OCiuWIhuOBkeOBpuOBj+OBoOOBleOBhOOAgicpXG4gICAgfVxuICAgIHRocm93IGVycm9yXG4gIH0gZmluYWxseSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpXG4gIH1cblxuICBjb25zdCBjb250ZW50ID0gcmVzcG9uc2UuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudFxuICBpZiAoIWNvbnRlbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09wZW5BSSBBUEnjgYvjgonjga7jg6zjgrnjg53jg7PjgrnjgYznqbrjgafjgZnjgIInKVxuICB9XG5cbiAgY29uc3QgcGFyc2VkRGF0YSA9IEpTT04ucGFyc2UoY29udGVudClcbiAgcmV0dXJuIHZhbGlkYXRlSGVhbHRoUmVwb3J0RGF0YShwYXJzZWREYXRhKVxufVxuXG50eXBlIEVycm9yTWV0YSA9IHtcbiAgaGludD86IHN0cmluZ1xuICB0cmFjZUlkPzogc3RyaW5nXG4gIHJldHJ5YWJsZT86IGJvb2xlYW5cbn1cblxuZnVuY3Rpb24ganNvbkVycm9yKHN0YXR1czogbnVtYmVyLCBjb2RlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IEVycm9yTWV0YSkge1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICAuLi5tZXRhLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHsgc3RhdHVzIH1cbiAgKVxufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsIk5leHRSZXNwb25zZSIsInZhbGlkYXRlSGVhbHRoUmVwb3J0RGF0YSIsInJ1bnRpbWUiLCJNQVhfRklMRV9TSVpFIiwiTUFYX0ZJTEVTIiwiVElNRU9VVF9NUyIsIk51bWJlciIsInByb2Nlc3MiLCJlbnYiLCJPQ1JfVElNRU9VVF9NUyIsIkFMTE9XRURfTUlNRV9UWVBFUyIsIlVTRV9NT0NLX09DUiIsIk9QRU5BSV9BUElfS0VZIiwic3RhcnRzV2l0aCIsIk1PQ0tfT0NSIiwiU1lTVEVNX1BST01QVCIsIlBPU1QiLCJyZXEiLCJoZWFkZXJzIiwiZ2V0IiwiaW5jbHVkZXMiLCJqc29uRXJyb3IiLCJoaW50IiwiZm9ybURhdGEiLCJmaWxlcyIsImdldEFsbCIsImZpbHRlciIsImYiLCJGaWxlIiwibGVuZ3RoIiwidXBsb2FkcyIsImZpbGUiLCJ0eXBlIiwiam9pbiIsInNpemUiLCJidWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiYXJyYXlCdWZmZXIiLCJwdXNoIiwibWltZXR5cGUiLCJvcmlnaW5hbG5hbWUiLCJuYW1lIiwiZGF0YSIsInBlcmZvcm1PY3IiLCJqc29uIiwic3VjY2VzcyIsInN0YXR1cyIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJFcnJvciIsInRyYWNlSWQiLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwidW5kZWZpbmVkIiwicmV0cnlhYmxlIiwid2FybiIsInNhbXBsZSIsIm9wZW5haSIsImFwaUtleSIsInRpbWVvdXQiLCJpbWFnZUNvbnRlbnRzIiwibWFwIiwiYmFzZTY0SW1hZ2UiLCJ0b1N0cmluZyIsImltYWdlX3VybCIsInVybCIsImRldGFpbCIsImNvbnRyb2xsZXIiLCJBYm9ydENvbnRyb2xsZXIiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJyZXNwb25zZSIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRleHQiLCJyZXNwb25zZV9mb3JtYXQiLCJtYXhfdG9rZW5zIiwidGVtcGVyYXR1cmUiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJjaG9pY2VzIiwicGFyc2VkRGF0YSIsIkpTT04iLCJwYXJzZSIsImNvZGUiLCJtZXRhIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ocr/route.ts\n");

/***/ }),

/***/ "(rsc)/./shared/health-report.schema.ts":
/*!****************************************!*\
  !*** ./shared/health-report.schema.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExaminationItemSchema: () => (/* binding */ ExaminationItemSchema),\n/* harmony export */   HealthReportDataSchema: () => (/* binding */ HealthReportDataSchema),\n/* harmony export */   OverallFindingsSchema: () => (/* binding */ OverallFindingsSchema),\n/* harmony export */   PatientInfoSchema: () => (/* binding */ PatientInfoSchema),\n/* harmony export */   validateHealthReportData: () => (/* binding */ validateHealthReportData)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n\nconst PatientInfoSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    氏名: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable().optional(),\n    受診日: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable().optional()\n});\nconst ExaminationItemSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    項目名: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1, \"項目名は必須です\"),\n    値: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable().optional(),\n    単位: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable().optional(),\n    判定: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable().optional()\n});\nconst OverallFindingsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    総合判定: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable(),\n    医師の所見: zod__WEBPACK_IMPORTED_MODULE_0__.string().nullable()\n});\nconst HealthReportDataSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    受診者情報: PatientInfoSchema,\n    検査結果: zod__WEBPACK_IMPORTED_MODULE_0__.array(ExaminationItemSchema).min(1, \"検査結果が必要です\"),\n    総合所見: OverallFindingsSchema\n});\nconst validateHealthReportData = (data)=>{\n    return HealthReportDataSchema.parse(data);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zaGFyZWQvaGVhbHRoLXJlcG9ydC5zY2hlbWEudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXVCO0FBRWhCLE1BQU1DLG9CQUFvQkQsdUNBQVEsQ0FBQztJQUN4Q0csSUFBSUgsdUNBQVEsR0FBR0ssUUFBUSxHQUFHQyxRQUFRO0lBQ2xDQyxLQUFLUCx1Q0FBUSxHQUFHSyxRQUFRLEdBQUdDLFFBQVE7QUFDckMsR0FBRTtBQUVLLE1BQU1FLHdCQUF3QlIsdUNBQVEsQ0FBQztJQUM1Q1MsS0FBS1QsdUNBQVEsR0FBR1UsR0FBRyxDQUFDLEdBQUc7SUFDdkJDLEdBQUdYLHVDQUFRLEdBQUdLLFFBQVEsR0FBR0MsUUFBUTtJQUNqQ00sSUFBSVosdUNBQVEsR0FBR0ssUUFBUSxHQUFHQyxRQUFRO0lBQ2xDTyxJQUFJYix1Q0FBUSxHQUFHSyxRQUFRLEdBQUdDLFFBQVE7QUFDcEMsR0FBRTtBQUVLLE1BQU1RLHdCQUF3QmQsdUNBQVEsQ0FBQztJQUM1Q2UsTUFBTWYsdUNBQVEsR0FBR0ssUUFBUTtJQUN6QlcsT0FBT2hCLHVDQUFRLEdBQUdLLFFBQVE7QUFDNUIsR0FBRTtBQUVLLE1BQU1ZLHlCQUF5QmpCLHVDQUFRLENBQUM7SUFDN0NrQixPQUFPakI7SUFDUGtCLE1BQU1uQixzQ0FBTyxDQUFDUSx1QkFBdUJFLEdBQUcsQ0FBQyxHQUFHO0lBQzVDVyxNQUFNUDtBQUNSLEdBQUU7QUFPSyxNQUFNUSwyQkFBMkIsQ0FBQ0M7SUFDdkMsT0FBT04sdUJBQXVCTyxLQUFLLENBQUNEO0FBQ3RDLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZWFsdGgtcmVwb3J0LW9jci8uL3NoYXJlZC9oZWFsdGgtcmVwb3J0LnNjaGVtYS50cz83NGMyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5cbmV4cG9ydCBjb25zdCBQYXRpZW50SW5mb1NjaGVtYSA9IHoub2JqZWN0KHtcbiAg5rCP5ZCNOiB6LnN0cmluZygpLm51bGxhYmxlKCkub3B0aW9uYWwoKSxcbiAg5Y+X6Ki65pelOiB6LnN0cmluZygpLm51bGxhYmxlKCkub3B0aW9uYWwoKSxcbn0pXG5cbmV4cG9ydCBjb25zdCBFeGFtaW5hdGlvbkl0ZW1TY2hlbWEgPSB6Lm9iamVjdCh7XG4gIOmgheebruWQjTogei5zdHJpbmcoKS5taW4oMSwgJ+mgheebruWQjeOBr+W/hemgiOOBp+OBmScpLFxuICDlgKQ6IHouc3RyaW5nKCkubnVsbGFibGUoKS5vcHRpb25hbCgpLFxuICDljZjkvY06IHouc3RyaW5nKCkubnVsbGFibGUoKS5vcHRpb25hbCgpLFxuICDliKTlrpo6IHouc3RyaW5nKCkubnVsbGFibGUoKS5vcHRpb25hbCgpLFxufSlcblxuZXhwb3J0IGNvbnN0IE92ZXJhbGxGaW5kaW5nc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAg57eP5ZCI5Yik5a6aOiB6LnN0cmluZygpLm51bGxhYmxlKCksXG4gIOWMu+W4q+OBruaJgOimizogei5zdHJpbmcoKS5udWxsYWJsZSgpLFxufSlcblxuZXhwb3J0IGNvbnN0IEhlYWx0aFJlcG9ydERhdGFTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIOWPl+iouuiAheaDheWgsTogUGF0aWVudEluZm9TY2hlbWEsXG4gIOaknOafu+e1kOaenDogei5hcnJheShFeGFtaW5hdGlvbkl0ZW1TY2hlbWEpLm1pbigxLCAn5qSc5p+757WQ5p6c44GM5b+F6KaB44Gn44GZJyksXG4gIOe3j+WQiOaJgOimizogT3ZlcmFsbEZpbmRpbmdzU2NoZW1hLFxufSlcblxuZXhwb3J0IHR5cGUgUGF0aWVudEluZm8gPSB6LmluZmVyPHR5cGVvZiBQYXRpZW50SW5mb1NjaGVtYT5cbmV4cG9ydCB0eXBlIEV4YW1pbmF0aW9uSXRlbSA9IHouaW5mZXI8dHlwZW9mIEV4YW1pbmF0aW9uSXRlbVNjaGVtYT5cbmV4cG9ydCB0eXBlIE92ZXJhbGxGaW5kaW5ncyA9IHouaW5mZXI8dHlwZW9mIE92ZXJhbGxGaW5kaW5nc1NjaGVtYT5cbmV4cG9ydCB0eXBlIEhlYWx0aFJlcG9ydERhdGEgPSB6LmluZmVyPHR5cGVvZiBIZWFsdGhSZXBvcnREYXRhU2NoZW1hPlxuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVIZWFsdGhSZXBvcnREYXRhID0gKGRhdGE6IHVua25vd24pOiBIZWFsdGhSZXBvcnREYXRhID0+IHtcbiAgcmV0dXJuIEhlYWx0aFJlcG9ydERhdGFTY2hlbWEucGFyc2UoZGF0YSlcbn1cbiJdLCJuYW1lcyI6WyJ6IiwiUGF0aWVudEluZm9TY2hlbWEiLCJvYmplY3QiLCLmsI/lkI0iLCJzdHJpbmciLCJudWxsYWJsZSIsIm9wdGlvbmFsIiwi5Y+X6Ki65pelIiwiRXhhbWluYXRpb25JdGVtU2NoZW1hIiwi6aCF55uu5ZCNIiwibWluIiwi5YCkIiwi5Y2Y5L2NIiwi5Yik5a6aIiwiT3ZlcmFsbEZpbmRpbmdzU2NoZW1hIiwi57eP5ZCI5Yik5a6aIiwi5Yy75bir44Gu5omA6KaLIiwiSGVhbHRoUmVwb3J0RGF0YVNjaGVtYSIsIuWPl+iouuiAheaDheWgsSIsIuaknOafu+e1kOaenCIsImFycmF5Iiwi57eP5ZCI5omA6KaLIiwidmFsaWRhdGVIZWFsdGhSZXBvcnREYXRhIiwiZGF0YSIsInBhcnNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./shared/health-report.schema.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/next","vendor-chunks/form-data-encoder","vendor-chunks/zod","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Focr%2Froute&page=%2Fapi%2Focr%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Focr%2Froute.ts&appDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caseri%5CDesktop%5Chealth_report_ocr&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();