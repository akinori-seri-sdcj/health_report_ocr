
• Thanks for the logs — they point to two separate issues:

  - Dev server is forcing HTTPS/WSS causing cert errors and slow HMR.
  - API calls are going to Vite (5173) without a proxy, so /api returns 404.

  What’s happening

  - HTTPS/WSS errors: vite.config.ts forces origin: 'https://localhost' and HMR over wss to 443, but your browser doesn’t trust a
    cert for https://localhost → repeated ERR_CERT_AUTHORITY_INVALID and HMR retries slow down the page.
      - See frontend/vite.config.ts:server and preview blocks.
  - 404 on OCR: The frontend posts to /api/process-health-report on port 5173, but Vite isn’t proxying to the backend. The backend
    actually serves POST /process-health-report on 8080.
      - Backend route mount: backend/src/index.ts:39 uses app.use('/process-health-report', …) and backend/src/routes/health-
        report.routes.ts:16 sets the POST handler at '/'.
      - Your frontend falls back to “/api” in HTTPS mode (or uses VITE_API_URL if set). The request shown is http://localhost:5173/

  Fix (local development)

  - Edit frontend/vite.config.ts and remove these from both server and preview:
      - origin: 'https://localhost'
      - hmr: { host: 'localhost', clientPort: 443, protocol: 'wss' }
  - Minimal dev config should look like:
      - frontend/vite.config.ts:server
          - host: '0.0.0.0'
          - port: 5173
          - strictPort: true
      - Same for preview.
  - Optional: if you really need HTTPS in dev, generate a trusted cert (e.g., mkcert) and set server.https with that cert instead of
    forcing origin/WSS.

  2. Add a Vite proxy to reach the backend

  - Still in frontend/vite.config.ts:server, add:
      - proxy: {
        '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
        }
        }
  - This maps /api/process-health-report → http://localhost:8080/process-health-report (matches backend).

  3. Ensure frontend picks the right API base

  - You already have frontend/.env: VITE_API_URL=http://localhost:8080.
      - If you add the proxy above, you can alternatively use VITE_API_URL=/api (or unset it) so the client always uses /api and
        lets Vite proxy handle dev vs prod.
  - Frontend code builds the URL here: frontend/src/api/healthReportApi.ts:12
      - It prefers import.meta.env.VITE_API_URL, otherwise falls back based on protocol.
      - After the proxy change, either keep VITE_API_URL=/api in dev or remove it so HTTPS fallback doesn’t kick in. Most consistent
        is to set VITE_API_URL=/api.

  4. Run and verify

  - Start backend: cd backend && npm run dev (listens on 8080; see backend/src/index.ts:13)
  - Start frontend: cd frontend && npm run dev
  - Open http://localhost:5173
  - Confirm:
      - No more wss://localhost or https://localhost errors in the console.
      - OCR POST goes to http://localhost:5173/api/process-health-report and is proxied to http://localhost:8080/process-health-
        report (200/JSON, not 404).

  If you must use HTTPS locally

  - Create a trusted local cert (mkcert or OS-trusted CA).
  - Configure Vite with server.https = { key, cert } and remove the origin/custom HMR block.
  - Update .env to VITE_API_URL=https://localhost/api and keep the proxy; or reverse-proxy in front (Nginx) with a valid cert and
    map /api upstream to http://backend:8080.

  One more thing (PWA/Service Worker)

  - If you previously loaded a built PWA, a service worker might cache API patterns for https://localhost/api/* (see frontend/
    vite.config.ts:workbox). If behavior seems sticky, unregister the SW and clear site data:
      - Chrome DevTools → Application → Service Workers → Unregister; then Clear Storage → Clear site data.

  Want me to patch vite.config.ts to add the proxy and de-HTTPS the dev config?
